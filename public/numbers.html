<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Numaralar</title>

<style>
body{
  background:#0f172a;
  color:#e5e7eb;
  font-family:Arial, sans-serif;
  margin:0;
  padding:20px;
}
h1,h3{margin-bottom:10px}
select,input,button{padding:6px;margin-right:6px}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  border:1px solid #334155;
  padding:8px;
}
th{background:#1e293b}
tr:hover{background:#1f2937;cursor:pointer}

#profileModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
}
#profileBox{
  background:#020617;
  padding:20px;
  width:320px;
  border-radius:8px;
}
a{color:#38bdf8;text-decoration:none}
</style>
</head>

<body>

<h1>Numaralar</h1>

<!-- PROFİL EKLE -->
<div style="margin-bottom:20px;border:1px solid #334155;padding:10px;">
  <h3>Profil Ekle</h3>
  <select id="addHashtag"></select>
  <input id="addUsername" placeholder="Instagram kullanıcı adı">
  <button onclick="addProfile()">Ekle</button>
  <div id="addResult"></div>
</div>

<!-- FİLTRE -->
<select id="hashtagFilter">
  <option value="">Tümü</option>
</select>

<div id="tableArea"></div>

<!-- MODAL -->
<div id="profileModal">
  <div id="profileBox">
    <h3 id="mUser"></h3>
    <p>Hashtag: <span id="mHashtag"></span></p>
    <a id="mUrl" target="_blank">Instagram Profili</a><br><br>
    <button onclick="closeProfile()">Kapat</button>
  </div>
</div>

<script>
/* ===============================
   HASHTAGS
=============================== */
const ALL_HASHTAGS = [
  "gelinlik","ayakkabi","bungalow","hali","giyim","organizasyon",
  "taki","perde","emlak","tekstil","mimar","aydinlatma",
  "mobilya","kuyumcu","prefabrik","duvarkagidi","araba","tatilkoyu"
];

const addHashtag = document.getElementById("addHashtag");
const filterSelect = document.getElementById("hashtagFilter");

ALL_HASHTAGS.forEach(h=>{
  const o1=document.createElement("option");
  o1.value=h;o1.textContent="#"+h;
  addHashtag.appendChild(o1);

  const o2=o1.cloneNode(true);
  filterSelect.appendChild(o2);
});

/* ===============================
   DATA
=============================== */
let DATA=[];

/* ===============================
   LOAD
=============================== */
async function loadData(){
  const res=await fetch("/api/numbers");
  DATA=await res.json();
  renderTable();
}

/* ===============================
   TABLE
=============================== */
function renderTable(filter=""){
  let html=`
  <table>
    <tr>
      <th>#</th>
      <th>Kullanıcı</th>
      <th>Hashtag</th>
      <th>Profil</th>
    </tr>`;

  DATA.forEach((item,i)=>{
    if(filter && item.hashtag!==filter) return;
    html+=`
    <tr onclick='openProfile(${JSON.stringify(item)})'>
      <td>${i+1}</td>
      <td>${item.username}</td>
      <td>#${item.hashtag}</td>
      <td>Görüntüle</td>
    </tr>`;
  });

  html+="</table>";
  document.getElementById("tableArea").innerHTML=html;
}

filterSelect.addEventListener("change",e=>{
  renderTable(e.target.value);
});

/* ===============================
   MODAL
=============================== */
function openProfile(item){
  document.getElementById("mUser").textContent=item.username;
  document.getElementById("mHashtag").textContent="#"+item.hashtag;
  document.getElementById("mUrl").href=item.profileUrl;
  document.getElementById("profileModal").style.display="flex";
}
function closeProfile(){
  document.getElementById("profileModal").style.display="none";
}

/* ===============================
   ADD PROFILE
=============================== */
async function addProfile(){
  const username=document.getElementById("addUsername").value.trim();
  const hashtag=addHashtag.value;

  if(!username){
    alert("Kullanıcı adı boş");
    return;
  }

  await fetch("/api/numbers",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      username,
      hashtag,
      profileUrl:"https://instagram.com/"+username
    })
  });

  document.getElementById("addUsername").value="";
  document.getElementById("addResult").textContent="✔ Profil eklendi";
  loadData();
}

/* ===============================
   START
=============================== */
loadData();
</script>

</body>
</html>
