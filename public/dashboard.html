<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Yönetim Paneli</title>

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#0f172a;
  color:#e5e7eb;
  display:flex;
}
.sidebar{
  width:240px;
  background:#020617;
  padding:20px;
  height:100vh;
}
.sidebar h2{margin-bottom:20px;}
.sidebar a{
  display:block;
  color:#cbd5f5;
  text-decoration:none;
  padding:10px;
  border-radius:6px;
  margin-bottom:6px;
  cursor:pointer;
}
.sidebar a:hover{background:#1e293b;}
.main{
  flex:1;
  padding:30px;
  overflow-y:auto;
}
.hidden{display:none}

/* DASHBOARD */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:20px;
}
.card{
  background:#020617;
  padding:20px;
  border-radius:10px;
  text-align:center;
  cursor:pointer;
}
.card:hover{background:#1e293b}

/* TABLO */
table{
  width:100%;
  border-collapse:collapse;
  background:#020617;
  margin-top:15px;
}
th,td{
  padding:10px;
  border-bottom:1px solid #1e293b;
}
th{color:#94a3b8}

/* FORM */
input,select,button{
  padding:8px;
  width:100%;
  margin-bottom:10px;
}
button{
  background:#2563eb;
  border:none;
  color:#fff;
  cursor:pointer;
}
.tabs button{
  width:auto;
  margin-right:5px;
  background:#1e293b;
}
.tabs button.active{background:#2563eb}
.sidebar a.active-menu {
  background: #2563eb;
  color: #fff;
  font-weight: bold;
}
.count {
  margin-top: 10px;
  font-size: 26px;
  font-weight: bold;
  color: #38bdf8;
}

</style>
</head>

<body>


<div class="sidebar">
  <h2>Yönetim Paneli</h2>
  <a onclick="show('dashboard')">Dashboard</a>
  <a onclick="show('orders')">Siparişler</a>
  <a onclick="show('trial')">Deneme Hizmeti</a>
  <a onclick="show('staff')">Personel Prim</a>
  <a onclick="show('appointments')">Randevular</a>
  <a href="numbers.html">Numaralar</a>
</div>

<div class="main">

<!-- DASHBOARD -->
<div id="dashboard">
  <h1>Dashboard</h1>
  <div class="cards">
    <div class="card" onclick="show('orders')">Siparişler</div>
    <div class="card" onclick="show('trial')">Deneme Hizmeti</div>
    <div class="card" onclick="show('staff')">Personel Prim</div>
    <div class="card" onclick="show('appointments')">Randevular</div>
    <div class="card" onclick="location.href='numbers.html'">Numaralar</div>
  </div>
</div>

<!-- SİPARİŞLER -->
<div id="orders" class="hidden">
  <h1>Siparişler</h1>

  <div class="tabs">
    <button class="active" onclick="filterOrders('ALL',this)">Tümü</button>
    <button onclick="filterOrders('PAY',this)">Ödeme Günü</button>
    <button onclick="filterOrders('RENEW',this)">Yenileme Günü</button>
  </div>

  <button onclick="show('addOrder')">+ Yeni Sipariş</button>

  <table>
    <thead>
      <tr>
        <th>Müşteri</th>
        <th>Telefon</th>
        <th>Hizmet</th>
        <th>Fiyat</th>
        <th>Ödeme</th>
        <th>Yenileme</th>
      </tr>
    </thead>
    <tbody id="orderRows"></tbody>
  </table>
</div>

<!-- YENİ SİPARİŞ -->
<div id="addOrder" class="hidden">
  <h1>Yeni Sipariş</h1>
  <input id="name" placeholder="Müşteri Adı">
  <input id="phone" placeholder="Telefon">
  <select id="service">
    <option>Beğeni</option>
    <option>Yorum</option>
    <option>Keşfet</option>
    <option>Meta Reklamları</option>
  </select>
  <input id="price" placeholder="Fiyat">
  <label>Ödeme Tarihi</label>
  <input type="date" id="pay">
  <label>Yenileme Tarihi</label>
  <input type="date" id="renew">
  <button onclick="saveOrder()">Kaydet</button>
</div>

<!-- DENEME -->
<div id="trial" class="hidden">
  <h1>Deneme Hizmeti</h1>
  <input placeholder="Sipariş Linki">
  <select>
    <option>Beğeni</option>
    <option>Yorum</option>
    <option>Keşfet</option>
  </select>
  <button>Kaydet</button>
</div>

<!-- PERSONEL -->
<div id="staff" class="hidden">
  <h1>Personel Prim</h1>
  <p>Aylık Ciro: (siparişlerden manuel)</p>
  <p>Prim: (sonra bağlanacak)</p>
</div>

<!-- RANDEVULAR -->
<div id="appointments" class="hidden">
  <h1>Randevular</h1>
  <input placeholder="Telefon">
  <input type="date">
  <input type="time">
  <input placeholder="Not">
  <button>Kaydet</button>
</div>

</div>

<script>
let allOrders=[];
let filter="ALL";

function show(id){
 document.querySelectorAll('.main>div').forEach(d=>d.classList.add('hidden'));
 document.getElementById(id).classList.remove('hidden');
 const titles = {
  dashboard: "Dashboard",
  orders: "Siparişler",
  trial: "Deneme Hizmeti",
  staff: "Personel Prim",
  appointments: "Randevular"
};

setTitle(titles[section] || "Yönetim Paneli");

}

async function loadOrders(){
 const res=await fetch("/api/orders");
 allOrders=await res.json();
 renderOrders();
}

async function saveOrder(){
 const order={
  name:name.value,
  phone:phone.value,
  service:service.value,
  price:price.value,
  pay:pay.value,
  renew:renew.value
 };
 await fetch("/api/orders",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify(order)
 });
 show("orders");
 loadOrders();
}

function filterOrders(f,b){
 filter=f;
 document.querySelectorAll('.tabs button').forEach(x=>x.classList.remove('active'));
 b.classList.add('active');
 renderOrders();
}

function renderOrders(){
 const today=new Date().toISOString().split("T")[0];
 orderRows.innerHTML="";
 allOrders.filter(o=>{
  if(filter==="PAY") return o.pay===today;
  if(filter==="RENEW") return o.renew===today;
  return true;
 }).forEach(o=>{
  orderRows.innerHTML+=`
   <tr>
    <td>${o.name}</td>
    <td>${o.phone}</td>
    <td>${o.service}</td>
    <td>${o.price}</td>
    <td>${o.pay||"-"}</td>
    <td>${o.renew||"-"}</td>
   </tr>`;
 });
}

loadOrders();
fetch("/api/orders")
  .then(res => res.json())
  .then(data => {
    document.getElementById("orderCount").innerText = data.length;
  });
function setTitle(text) {
  document.querySelector("h1").innerText = text;
}

</script>
<script>
  fetch("/menu.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("menu").innerHTML = html;
    });
</script>
<script>
function setActiveMenu(name) {
  document.querySelectorAll(".sidebar a").forEach(a => {
    a.classList.remove("active-menu");
  });

  const active = document.querySelector(`.sidebar a[onclick*="${name}"]`);
  if (active) active.classList.add("active-menu");
}
</script>

</body>
</html>
