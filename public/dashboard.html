<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Yönetim Paneli</title>

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:#e5e7eb;display:flex}
.sidebar{width:240px;background:#020617;padding:20px;height:100vh}
.sidebar a{display:block;color:#cbd5f5;padding:10px;border-radius:6px;margin-bottom:6px;cursor:pointer;text-decoration:none}
.sidebar a.active,.sidebar a:hover{background:#2563eb;color:#fff}
.main{flex:1;padding:30px;overflow-y:auto}
.hidden{display:none}
.cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:20px}
.card{background:#020617;padding:20px;border-radius:10px;text-align:center;cursor:pointer}
.card:hover{background:#1e293b}
table{width:100%;border-collapse:collapse;background:#020617;margin-top:15px}
th,td{padding:10px;border-bottom:1px solid #1e293b}
th{color:#94a3b8}
input,select,button{padding:8px;width:100%;margin-bottom:10px}
button{background:#2563eb;border:none;color:#fff;cursor:pointer}

input,select,textarea{
 background:#020617;
 color:#e5e7eb;
 border:1px solid #334155;
}
input::placeholder,textarea::placeholder{color:#94a3b8}
option{background:#020617;color:#e5e7eb}
</style>
</head>

<body>

<div class="sidebar">
  <a class="active" onclick="show('dashboard',this)">Dashboard</a>
  <a onclick="show('orders',this)">Siparişler</a>
  <a onclick="show('staff',this)">Personel Prim</a>
  <a onclick="show('trials',this)">Deneme Hizmeti</a>
  <a onclick="show('appointments',this)">Randevular</a>
  <a href="numbers.html">Numaralar</a>
</div>

<div class="main">

<div id="dashboard">
  <h1>Dashboard</h1>
  <div class="cards">
    <div class="card" onclick="go('orders')">Siparişler</div>
    <div class="card" onclick="go('staff')">Personel Prim</div>
    <div class="card" onclick="go('trials')">Deneme Hizmeti</div>
    <div class="card" onclick="go('appointments')">Randevular</div>
    <div class="card" onclick="location.href='numbers.html'">Numaralar</div>
  </div>
</div>

<div id="orders" class="hidden">
  <h1>Siparişler</h1>
  <button onclick="go('addOrder')">+ Yeni Sipariş</button>
  <table>
    <thead>
      <tr>
        <th>Müşteri</th><th>Telefon</th><th>Hizmet</th>
        <th>Fiyat</th><th>Durum</th>
      </tr>
    </thead>
    <tbody id="orderRows"></tbody>
  </table>
</div>

<div id="addOrder" class="hidden">
  <h1>Yeni Sipariş</h1>
  <input id="customer" placeholder="Müşteri">
  <input id="phone" placeholder="Telefon">
  <select id="service">
    <option value="">Hizmet Seç</option>
    <option value="kesfet">Keşfet</option>
    <option value="meta">Meta Reklam</option>
    <option value="meta_kesfet">Meta Reklam + Keşfet</option>
  </select>
  <input id="price" placeholder="Fiyat">
  <input id="staff" placeholder="Personel">
  <button onclick="saveOrder()">Kaydet</button>
</div>

<div id="staff" class="hidden">
  <h1>Personel Prim</h1>
  <input id="staffName" placeholder="Personel">
  <input id="staffMonth" type="month">
  <button onclick="loadStaff()">Hesapla</button>
  <div id="staffResult"></div>
</div>

<div id="trials" class="hidden">
  <h1>Deneme Hizmeti</h1>
  <input id="trialLink" placeholder="Link">
  <select id="trialCategory">
    <option>Beğeni</option>
    <option>Yorum</option>
    <option>Keşfet</option>
  </select>
  <button onclick="saveTrial()">Kaydet</button>
  <div id="trialList"></div>
</div>

<div id="appointments" class="hidden">
  <h1>Randevular</h1>
  <input id="appPhone" placeholder="Telefon">
  <input id="appDate" type="date">
  <input id="appTime" type="time">
  <button onclick="saveAppointment()">Kaydet</button>
  <div id="appointmentList"></div>
</div>

<h2>Numaralar</h2>
<table id="tbl">
<thead>
<tr><th>#</th><th>Kullanıcı</th><th>Hashtag</th><th>Profil</th></tr>
</thead>
<tbody></tbody>
</table>

</div>

<script>
let orders=[],trials=[],appointments=[];

function show(id,el){
 document.querySelectorAll('.main > div').forEach(d=>d.classList.add('hidden'));
 document.getElementById(id).classList.remove('hidden');
 document.querySelectorAll('.sidebar a').forEach(a=>a.classList.remove('active'));
 if(el) el.classList.add('active');
}
function go(id){ show(id); }

async function loadOrders(){
 const r=await fetch('/api/orders');
 orders=await r.json();
 orderRows.innerHTML=orders.map(o=>`
 <tr>
  <td>${o.customer||''}</td>
  <td>${o.phone||''}</td>
  <td>${o.service||''}</td>
  <td>${o.price||''}</td>
  <td>${o.status||'pending'}</td>
 </tr>`).join('');
}

async function saveOrder(){
 const customer=document.getElementById('customer').value.trim();
 const phone=document.getElementById('phone').value.trim();
 const service=document.getElementById('service').value;
 const price=document.getElementById('price').value.trim();
 const staff=document.getElementById('staff').value.trim();

 if(!customer||!phone||!service||!price){
  alert('Lütfen tüm alanları doldurun');
  return;
 }

 await fetch('/api/orders',{
  method:'POST',
  headers:{'Content-Type':'application/json'},
  body:JSON.stringify({customer,phone,service,price,staff})
 });

 document.getElementById('customer').value='';
 document.getElementById('phone').value='';
 document.getElementById('service').value='';
 document.getElementById('price').value='';
 document.getElementById('staff').value='';

 loadOrders(); go('orders');
}

async function loadStaff(){
 const r=await fetch(`/api/staff-stats?staff=${staffName.value}&month=${staffMonth.value}`);
 const d=await r.json();
 staffResult.innerHTML=`<p>Ciro: ${d.turnover}</p><p>Prim: ${d.commission}</p>`;
}

async function loadTrials(){
 const r=await fetch('/api/trials');
 trials=await r.json();
 trialList.innerHTML=trials.map(t=>`<div>${t.category} - ${t.link}</div>`).join('');
}
async function saveTrial(){
 await fetch('/api/trials',{
  method:'POST',
  headers:{'Content-Type':'application/json'},
  body:JSON.stringify({link:trialLink.value,category:trialCategory.value})
 });
 loadTrials();
}

async function loadAppointments(){
 const r=await fetch('/api/appointments');
 appointments=await r.json();
 appointmentList.innerHTML=appointments.map(a=>`<div>${a.phone} - ${a.date} ${a.time}</div>`).join('');
}
async function saveAppointment(){
 await fetch('/api/appointments',{
  method:'POST',
  headers:{'Content-Type':'application/json'},
  body:JSON.stringify({phone:appPhone.value,date:appDate.value,time:appTime.value})
 });
 loadAppointments();
}

async function loadNumbers(){
 const r=await fetch('/api/numbers');
 const data=await r.json();
 const tbody=document.querySelector('#tbl tbody');
 tbody.innerHTML='';
 data.forEach((n,i)=>{
  tbody.innerHTML+=`
   <tr>
    <td>${i+1}</td>
    <td>${n.kullanici_adi||n.username}</td>
    <td>${n.hashtag}</td>
    <td><a href="${n.profileUrl}" target="_blank">Profil</a></td>
   </tr>`;
 });
}

loadOrders();
loadTrials();
loadAppointments();
loadNumbers();
</script>

</body>
</html>
